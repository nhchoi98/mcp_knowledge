---
title: Application lock
tags: []
created: ""
updated: ""
source: ""
status: draft
---
# Application lock

### ⚙️ 애플리케이션 락의 작동 원리

애플리케이션 락은 다음과 같은 흐름으로 작동합니다.

1. **자원 식별:** 락을 걸어야 할 **공유 자원**을 정의합니다. (예: `tenant_id=123`의 배포 작업)
2. **락 획득 시도:** 요청이 들어오면, 지정된 자원에 대해 락을 획득하려고 시도합니다.
3. **락 획득 성공 (처리 시작):** 락 획득에 성공하면, 요청을 독점적으로 처리합니다.
    - 이 단계에서 외부 API 호출 등 시간이 오래 걸리는 I/O 작업을 수행합니다.
4. **락 획득 실패 (거부 또는 대기):** 이미 다른 요청이 해당 자원의 락을 가지고 있다면,
    - **즉시 오류를 반환**하거나, (가장 일반적)
    - 정해진 시간 동안 **대기**합니다.
5. **락 해제:** 요청 처리가 완료(성공/실패 무관)되면 락을 해제하여 다음 요청이 처리할 수 있도록 합니다.

### 🆚 DB 락과의 결정적인 차이

| 특징 | 애플리케이션 락 (Redis, `asyncio.Lock`) | DB 트랜잭션 락 (`SELECT FOR UPDATE`) |
| --- | --- | --- |
| **관리 주체** | 애플리케이션/외부 캐시 서버 (Redis 등) | 데이터베이스 서버 |
| **적용 범위** | **비즈니스 로직 전체** (DB 접근, 외부 API 호출 등) | **DB 트랜잭션 내부**에서 접근하는 데이터 행(Row)이나 테이블 |
| **I/O 대기 처리** | **Non-blocking:** 외부 API 호출 중에도 DB 커넥션을 반환하고, 다른 요청을 처리할 수 있음. | **Blocking:** Lock을 잡은 상태로 I/O 대기 시 DB 커넥션을 점유하여 풀을 고갈시킴. |
| **용도** | **복잡한 비즈니스 프로세스**의 동시성 제어 및 직렬화. | DB 데이터의 원자성(Atomicity) 및 격리성(Isolation) 보장. |