---
title: DOM API
tags: []
created: ""
updated: ""
source: ""
status: draft
---
# DOM API

# Fetch와 XHR (XMLHttpRequest)

## 🔹 공통점

1. **HTTP 요청 전송 가능**
    - GET, POST, PUT, DELETE 등 요청 가능.
    - 헤더 설정, 데이터 전송, 서버 응답 수신 기능.
2. **비동기 통신 지원**
    - 둘 다 네트워크 요청을 비동기로 처리. (콜백 or Promise 기반)
3. **CORS 정책 적용**
    - SOP(Same-Origin Policy) / CORS 제약을 동일하게 받음.
4. **브라우저 내장 API**
    - 플러그인 없이 자바스크립트에서 바로 사용 가능.

## 🔹 차이점

| 구분 | **XMLHttpRequest (XHR)** | **Fetch API** |
| --- | --- | --- |
| 등장 시기 | 오래된 API (IE5~), AJAX의 핵심 | ES6 이후, 현대적 API |
| 반환 방식 | 이벤트 기반 (`onreadystatechange`, `onload`) | Promise 기반 (`then/catch/await`) |
| 코드 가독성 | 콜백 중첩 발생 → 복잡 | 체이닝 / async/await → 깔끔 |
| 요청/응답 | `responseText`, `responseXML` 사용 | `Response` 객체로 JSON, Blob, Text 등 다양한 파싱 지원 |
| 프로그래스(진행률) | 업로드/다운로드 progress 이벤트 지원 | 기본 지원 X (추가 작업 필요) |
| 동기 요청 | `false` 옵션으로 동기 요청 가능 (비추천, 메인 스레드 블록) | 항상 비동기 |
| 에러 처리 | 네트워크 에러만 감지 가능 (HTTP 404, 500도 성공으로 간주) | 네트워크 에러 + 응답 상태 확인 필요 (`res.ok`) |
| 취소 | `abort()` 메서드로 요청 취소 | `AbortController` 사용 |
|  |  |  |

# Fetch와 AbortController 지원

`AbortController`는 **비동기 작업 취소를 위한 표준 API**

## AbortController

- `AbortController`는 **취소 신호(`AbortSignal`)를 생성**하고, 이를 비동기 작업에 전달합니다.
- 나중에 `controller.abort()`를 호출하면 해당 작업이 중단됩니다
- `addEventListener`의 옵션에 `signal`을 넣으면, `abort()` 호출 시 자동으로 이벤트가 제거됩니다.

## 활용 사례

1. **네트워크 요청 중단** → 필요 없는 fetch 취소 (검색 자동완성, SPA 네비게이션 전환 등)
2. **타이머/이벤트 관리** → `abort()`로 이벤트 핸들러 해제
3. **동시 요청 관리** → 새 요청이 들어오면 기존 요청은 취소

# Web worker

# 파일 업로드와 XHR

```jsx
<input type="file" id="file" />
<progress id="bar" max="100" value="0"></progress>
<script>
const input = document.getElementById("file");
const bar = document.getElementById("bar");

input.addEventListener("change", () => {
const file = input.files[0];
const xhr = new XMLHttpRequest();
xhr.open("POST", "/upload");

// 업로드 진행률
xhr.upload.onprogress = (e) => {
  if (e.lengthComputable) {
    const percent = Math.round((e.loaded / e.total) * 100);
    bar.value = percent;
  }
};

xhr.onload = () => {
  if (xhr.status >= 200 && xhr.status < 300) {
    console.log("완료");
    bar.value = 100;
  } else {
    console.error("업로드 실패", xhr.status);
  }
};

xhr.onerror = () => console.error("네트워크 에러");

const form = new FormData();
form.append("file", file);
xhr.send(form);

});
</script>
```